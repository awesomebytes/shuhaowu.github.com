/*! orbitjs (https://github.com/shuhaowu/orbitjs) v: 1cd657cd74ba1e7e8959da16212473a2fd2b0af4*/
"use strict";var math=function(){function a(a){this.message=a}function b(a,b){if(a.length!==b.length)throw m}function c(b,c){if(3!==b.length||3!==c.length)throw new a("can only cross vectors with 3 components");return[b[1]*c[2]-b[2]*c[1],b[2]*c[0]-b[0]*c[2],b[0]*c[1]-b[1]*c[0]]}function d(a,c){b(a,c);for(var d=0,e=0,f=a.length;f>e;e++)d+=a[e]*c[e];return d}function e(a){for(var b=0,c=0,d=a.length;d>c;c++)b+=a[c]*a[c];return Math.sqrt(b)}function f(a,b){var c=a[0]*Math.cos(b)-a[1]*Math.sin(b),d=a[0]*Math.sin(b)+a[1]*Math.cos(b);return[c,d]}function g(a,c,d){function e(a,b){switch(d){case"add":return a+b;case"sub":return a-b;case"mul":return a*b;case"div":return a/b}}var f=null,g=null,h=null,i=null;a.length?f=a:h=a,c.length?g=c:i=c;var j,k,l;if(null!==f&&null!==g)for(b(f,g),j=[],k=0,l=f.length;l>k;k++)j.push(e(f[k],g[k]));else if(null!==h&&null!==i)j=e(h,i);else if(null!==f&&null!==i)for(j=[],k=0,l=f.length;l>k;k++)j.push(e(f[k],i));else if(null!==h&&null!==g)for(j=[],k=0,l=g.length;l>k;k++)j.push(e(h,g[k]));return j}function h(a,b){return g(a,b,"add")}function i(a,b){return g(a,b,"sub")}function j(a,b){return g(a,b,"mul")}function k(a,b){return g(a,b,"div")}function l(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}var m=new a("a.length != b.length");return{e:{add:h,sub:i,mul:j,div:k},cross:c,dot:d,norm:e,round:l,rotate:f,MathError:a,DimensionMismatchError:m}}(),Orbits=function(){var a={mu_earth:398600,mu_kerbin:3531.6},b={};return b.norm=function(a){return void 0!==a.length?math.norm(a):a},b.angular_momentum=function(a,b){return math.cross(a,b)},b.orbital_specific_energy=function(c,d,e){return c=b.norm(c),d=b.norm(d),e=e||a.mu_earth,c*c/2-e/d},b.eccentricity_vector=function(b,c,d,e){e=e||a.mu_earth;var f=math.e.div(math.cross(b,c),e),g=math.e.div(d,math.norm(d));return math.sub(f,g)},{constants:a,utils:b}}();Orbits.Elliptic2D=function(a){function b(b){this.a=b.a,this.e=b.e,this.mu=b.mu||a.constants.mu_kerbin,this.body_radius=b.r,this.show_r_vector=b.show_r_vector||!1,this.show_v_vector=b.show_v_vector||!1,this.recompute()}b.prototype.recompute=function(){this.b=this.a*Math.sqrt(1-this.e*this.e),this.p=this.a*(1-this.e*this.e),this.c=this.a*this.e,this.r_p=this.a*(1-this.e),this.r_a=this.a*(1+this.e),this.n=Math.sqrt(this.mu/Math.pow(this.a,3)),this.period=Math.sqrt(4*Math.pow(Math.PI,2)*Math.pow(this.a,3)/this.mu),this.specific_energy=-this.mu/(2*this.a),this.periapsis_altitude=this.r_p-this.body_radius,this.apoapsis_altitude=this.r_a-this.body_radius,this.v_p=this.rv_at_theta(0).v},b.prototype.rv_at_theta=function(a){var b=this.p/(1+this.e*Math.cos(a)),c=Math.sqrt(this.mu*(2/b-1/this.a));return{r:b,v:c,altitude:b-this.body_radius,perifocal:{rx:b*Math.cos(a),ry:b*Math.sin(a),vx:-Math.sqrt(this.mu/this.p)*Math.sin(a),vy:Math.sqrt(this.mu/this.p)*(this.e+Math.cos(a))}}},b.prototype.E=function(a){return 2*Math.atan(Math.sqrt(1-this.e)/Math.sqrt(1+this.e)*Math.tan(a/2))},b.prototype.time_since_periapsis=function(a){var b=this.E(a);return(b-this.e*Math.sin(b))/this.n},b.prototype.theta_given_time=function(a){for(var b,c=this.n*a,d=c,e=0;;){if(b=d+(c-d+this.e*Math.sin(d))/(1-this.e*Math.cos(d)),Math.abs(b-d)<1e-5)break;d=b,e++}for(var f=2*Math.atan(Math.sqrt((1+this.e)/(1-this.e))*Math.tan(b/2));0>f;)f+=2*Math.PI;return f%(2*Math.PI)},b.prototype.trace=function(a){a=a||.0087266;for(var b,c,d=[],e=0;e<2*Math.PI;e+=a)b=this.rv_at_theta(e),c=this.time_since_periapsis(e),d.push({rv:b,altitude:b.altitude,t:c});return d},b.prototype.canvas_length_scale=function(a){return a*this.usable_canvas_width/(2*this.a)},b.prototype.canvas_velocity_scale=function(a){var b=.5;return a*b*this.usable_canvas_width/(2*this.v_p)},b.prototype.scale_length_to_canvas=function(a,b){var c=(this.canvas_width-this.usable_canvas_width)/2;return a=this.canvas_length_scale(this.r_a+a),b=this.canvas_length_scale(b),{x:c+a,y:this.canvas_height/2-b}},b.prototype.scale_velocity_to_canvas=function(a,b){(this.canvas_width-this.usable_canvas_width)/2;return{x:this.canvas_velocity_scale(a),y:-this.canvas_velocity_scale(b)}};var c=10;return b.prototype.draw_background=function(a){var b=a.background_ctx,d=this.scale_length_to_canvas(0,0),e=c/2;a.draw_circle(b,d.x,d.y,this.canvas_length_scale(this.body_radius),a.styles.m1),b.beginPath(),b.moveTo(d.x-e,d.y),b.lineTo(d.x+e,d.y),b.moveTo(d.x,d.y-e),b.lineTo(d.x,d.y+e),b.strokeStyle=a.styles.center.color,b.stroke(),a.draw_ellipse(b,this.canvas_width/2,this.canvas_height/2,this.canvas_length_scale(this.a),this.canvas_length_scale(this.b),a.styles.orbit)},b.prototype.update_info=function(a,b,c,d){if(a.info_el){var e=function(b,c){var d=a.info_el.querySelectorAll(b);d.length>0&&(d[0].innerHTML=math.round(c,2))};e(".apoapsis",this.r_a),e(".periapsis",this.r_p),e(".semimajor",this.a),e(".eccentricity",this.e),e(".time",b),e(".altitude",c.altitude),e(".velocity",c.v),e(".theta",180*d/Math.PI)}},b.prototype.draw_satellite=function(a,b,c){var d=8,e={size:20,angle:20*Math.PI/180,color:"#F00"},f={size:20,angle:20*Math.PI/180,color:"#F0F"},g=this.scale_length_to_canvas(0,0);b=this.scale_length_to_canvas(b.x,b.y),a.draw_circle(a.foreground_ctx,b.x,b.y,d,a.styles.m2),this.show_r_vector&&a.draw_arrow(a.foreground_ctx,g.x,g.y,b.x,b.y,e),this.show_v_vector&&(c=this.scale_velocity_to_canvas(c.x,c.y),a.draw_arrow(a.foreground_ctx,b.x,b.y,b.x+c.x,b.y+c.y,f))},b.prototype.resize_canvas=function(a){this.canvas_width=a.background_el.width,this.canvas_height=a.background_el.height,this.usable_canvas_width=.9*a.background_el.width,this.draw_background(a)},b.prototype.init_canvas=function(a){this.resize_canvas(a);var b=this.theta_given_time(0),c=this.rv_at_theta(b);this.update_info(a,0,c,b)},b.prototype.draw_on=function(a,b){b=this.period*b/a.orbital_period_real_time,b%=this.period;var c=this.theta_given_time(b),d=this.rv_at_theta(c);this.draw_satellite(a,{x:d.perifocal.rx,y:d.perifocal.ry},{x:d.perifocal.vx,y:d.perifocal.vy}),this.update_info(a,b,d,c)},b}(Orbits);var Canvas=function(){function a(a,b,c){this.viewport=document.getElementById(a),this.background_el=this.viewport.querySelectorAll(".background")[0],this.foreground_el=this.viewport.querySelectorAll(".foreground")[0],this.background_ctx=this.background_el.getContext("2d"),this.foreground_ctx=this.foreground_el.getContext("2d"),b?(this.info_el=document.getElementById(b),this.frt_el=this.info_el.querySelectorAll(".frt"),this.frt_el.length>=0&&(this.frt_el=this.frt_el[0])):(this.info_el=null,this.frt_el=null),this.styles=c||{},this.styles.center=this.styles.center||{color:"#000"},this.styles.m1=this.styles.m1||{color:"#CCC",fill:"#1C6BA0"},this.styles.m2=this.styles.m2||{color:"#00F",fill:null},this.styles.orbit=this.styles.orbit||{color:"#000"},this.orbit=null,this.orbit_type=null,this.current_time=0,this.orbital_period_real_time=20}a.prototype._clear=function(a){a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this.background_el.width,this.background_el.height),a.restore()},a.prototype.clear_background=function(){this._clear(this.background_ctx)},a.prototype.clear_foreground=function(){this._clear(this.foreground_ctx)},a.prototype.set_orbit=function(a){this.orbit=a,this.clear_background(),this.clear_background(),this.timer_id&&window.clearInterval(this.timer_id),this.orbit.init_canvas(this),this.redraw();var b=(new Date).getTime(),c=this;this.timer_id=window.setInterval(function(){var a=(new Date).getTime();c.clear_foreground(),c.current_time=((new Date).getTime()-b)/1e3,c.redraw(),c.frt_el&&(c.frt_el.innerHTML=(new Date).getTime()-a)},33)},a.prototype.redraw=function(){this.orbit.draw_on(this,this.current_time)};var b=.5522848;return a.prototype.ink=function(a,b){b.fill?(a.fillStyle=b.fill,a.fill()):b.color?(a.strokeStyle=b.color,a.stroke()):a.stroke()},a.prototype.draw_ellipse=function(a,c,d,e,f,g){g=g||{};var h=e*b,i=f*b,j=c-e,k=d-f,l=j+2*e,m=k+2*f,n=j+e,o=k+f;a.beginPath(),a.moveTo(j,o),a.bezierCurveTo(j,o-i,n-h,k,n,k),a.bezierCurveTo(n+h,k,l,o-i,l,o),a.bezierCurveTo(l,o+i,n+h,m,n,m),a.bezierCurveTo(n-h,m,j,o+i,j,o),this.ink(a,g)},a.prototype.draw_circle=function(a,b,c,d,e){e=e||{},a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!1),this.ink(a,e)},a.prototype.draw_arrow=function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b,c),a.lineTo(d,e);var g=Math.atan2(e-c,d-b),h=Math.sqrt(Math.pow(e-c,2)+Math.pow(d-b,2)),i=h-f.size*Math.cos(f.angle),j=f.size*Math.sin(f.angle),k=math.rotate([i,j],g),l=math.rotate([i,-j],g);a.lineTo(k[0]+b,k[1]+c),a.lineTo(l[0]+b,l[1]+c),a.lineTo(d,e),this.ink(a,f)},a}();