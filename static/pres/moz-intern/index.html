<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
    <aside class="note">
      <section>
        <ul>
          <li>I'm a web dev intern for the past 15 weeks.</li>
          <li>Worked on two projects and here is my summary! :D</li>
        </ul>
      </section>
    </aside>
    <aside class="gdbar"><img src="images/mozilla.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>I've done two unrelated projects here at Mozilla.</li>
          <li>First I'll go over my work with SUMO, support.mozilla.org.</li>
          <li>Second, we will take a look at my adventure with statistics and
              how I implemented a system to catch "explosive" crashes.</li>
          <li>It's been a fun summer and I cannot believe it is ending so soon.</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Overview</h2>
    </hgroup>
    <article>
      <ul>
        <li>Two projects during this internship</li>
      </ul>
      <ul>
        <li>Support.mozilla.org (SUMO)
          <ul>
            <li>Bringing SUMO offline with IndexDB</li>
          </ul>
        </li>
      </ul>
      <ul>
        <li>Firefox crash stats (Socorro)
          <ul>
            <li>Automagically identify "explosive crashes"</li>
          </ul>
        </li>
      </ul>
      <ul class="build fade">
        <li>Lots of fun all around!</li>
      </ul>
      <footer class="source">
        Press 'p' to get presenter's notes
      </footer>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>support.mozilla.org is a site where Firefox users get support from each other.</li>
          <li>It is a wiki, a forum, a QA board, and much more.</li>
          <li>We cannot possibly take all features offline.</li>
          <li>The core feature is the wiki, and that is what we are interested in bringing offline.</li>
          <li>With the launch of Fx OS, it is even more important to have offline help due to our launch markets in places with worse internet.</li>
          <li>Hence these technical requirements.</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Taking SUMO offline</h2>
    </hgroup>
    <article>
      <p>Basic idea</p>
      <ul>
        <li>Allow users to look up help articles offline, such as on a Firefox OS device</li>
      </ul>
      <p>Technical requirements</p>
      <ul>
        <li>Must run entirely offline
          <ul>
            <li>Appcache and IndexedDB</li>
          </ul>
        </li>
        <li>Must run reasonably fast on a low powered device such as a Firefox OS phone</li>
        <li>Mobile friendly</li>
        <li>Translatable</li>
      </ul>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <p>Before we start, let us all take a moment to appreciate how we all hate CSS.</p>
      </section>
    </aside>
    <hgroup>
      <h2>Mandatory "I hate CSS" slide</h2>
    </hgroup>
    <article class="flexbox vcenter">
      <img src="images/css.gif" alt="I hate CSS, but whatever" title="I hate CSS, but whatever" />
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>JS apps with AngularJS is really easy. No more jQuery blobs!</li>
          <li>With angular, you could potentially have no server component, or a very minimal server component.</li>
          <li>IndexedDB sucks with AngularJS: I created a library to wrap idb's interface in angular's $q. Still no way to unittest properly as we cannot delete/flust idb.</li>
          <li>Appcache is a d******. Google it and you'll find all about it</li>
          <li>l10n support does not exist. So I wrote my own. The one on screen is outta date.</li>
          <li>Rolling my own thing will be a theme for the rest of this presentation (and arguably my life. However, I do not use Arch)</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>App with AngularJS</h2>
    </hgroup>
    <article>
      <ul>
        <li>Writing JS apps with AngularJS is great</li>
        <li>Perfect for an app on Firefox OS</li>
        <li>Watch out for IndexedDB, appcache, l10n
          <ul>
            <li>That's okay:</li>
            <li><a href="https://github.com/shuhaowu/angular-indexed-db">https://github.com/shuhaowu/angular-indexed-db</a></li>
            <li><a href="https://github.com/shuhaowu/angular-l10n">https://github.com/shuhaowu/angular-l10n</a></li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <slide>
    <aside class="note" style="font-size:0.8em;">
      <section>
        <ul>
          <li>Just packaging the content from SUMO was a pretty tough order as 
          I had no idea where to start. Big thanks to my mentor, mythmon, for all the help here.</li>
          <li>Downloading images is hard. We defer that after you download a bundle.</li>
          <li>Idb sucks in the sense that there is no easy way to flush out the db.
            <ul>
              <li>A hybrid between a kv store and a sql store, but took the worst from both worlds.</li>
              <li>Async callback based code, even when you wrap it with promises, suck as you lose tracebacks</li>
              <li>Spent many hours trying to figure out where my code error'ed from.</li>
              <li>Fun fact: most of my errors emitted from a function called "genericSuccess"</li>
            </ul>
          </li>
          <li>
            We thought offline search will be the hardest thing of them all. Turns out to be pretty straight foward.
            <ul>
              <li>Took a day of writing out the math and implementing the whole thing.</li>
              <li>Hardest part was to get idb to work with it</li>
            </ul>
          </li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Challenges</h2>
    </hgroup>
    <article>
      <ul class="build">
        <li>Downloading content</li>
        <li>Fiddling and debugging IndexedDB problems</li>
        <li>Offline search (more on that later)</li>
      </ul>
    </article>
  </slide>

  <slide>
    <aside class="note" style="font-size:0.8em;">
      <section>
        <ul>
          <li>TF-IDF is a method for determining the most relevent terms of a document. Repurposed as a search and ranking algorithm.</li>
          <li>Scores with importance, higher the better. The algorithm makes words such as "and" have a low score.</li>
          <li>Compound queries are addition operations: add the importance score for each word in the same documents together to get a "relevant" score for the whole document.</li>
          <li>Mostly language agonistic. Languages like chinese, korean, and japanese needs special indexer.</li>
          <li>Works almost as well as elastic search with the top search terms on sumo.</li>
          <li>Index only covers the summary of an article. It would be too big otherwise.</li>
          <li>Actually, with more data, languages such as Chinese, Korean, and Japanese will perform poorly (only tested on Chinese) unless we switch to a different ranking algorithm.</li>
          <li>Again, indexeddb sucks and is the bottleneck here. Actually, the most time taken is to load documents from idb so we can display the results' titles.</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Searching</h2>
    </hgroup>
    <article>
      <ul>
        <li>Built on <a href="http://en.wikipedia.org/wiki/Tf%E2%80%93idf">term frequency-inverse document frequency (TF-IDF)</a>
          <ul>
            <li>Scores each word and its importance for each document</li>
            <li>If a word appears frequently in one document but not overall, it will have a high score for that document</li>
            <li>Math is all on Wikipedia</li>
          </ul>
        </li>
        <li>
          Index is a big map. Maps word to document id and score.
          <ul>
            <li>Generated on the server</li>
            <li>Stored in IndexedDB</li>
          </ul>
        </li>
        <li>
          Loading from IndexedDB is a major bottle neck
          <ul>
            <li>Searching itself 1% - 5% of the total time to search</li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <p>Web people please go see the video for the presentation!</p>
      </section>
    </aside>
    <hgroup>
      <h2>Demo time!</h2>
    </hgroup>
    <article>
      <div class="flexbox vcenter">
        <img src="images/osumo1.png" />
        <img src="images/osumo2.png" />
        <img src="images/osumo3.png" />
      </div>
      <footer class="source"><a href="http://osumo.paas.allizom.org">http://osumo.paas.allizom.org</a></footer>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Current status</h2>
    </hgroup>
    <article>
      <ul>
        <li>Ready to land/code review</li>
        <li>App will live at http://osumo.paas.allizom.org</li>
        <li>App will be submitted to the Firefox marketplace after backend lands</li>
        <li>Code:
          <ul>
            <li><a href="https://github.com/mozilla/osumo">https://github.com/mozilla/osumo</a></li>
            <li><a href="https://github.com/mozilla/kitsune/pull/1574">https://github.com/mozilla/kitsune/pull/1574</a></li>
          </ul>
        </li>
      </ul>
      <p>Next step: bundle this app into Firefox OS with data prepopulated.</p>
    </article>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/gears.jpg)">
    <hgroup>
      <h2 class="white" style="text-shadow: 0 0 2px #000">Time to switch gears</h2>
      <h3 class="white" style="text-shadow: 0 0 2px #000">Crash stats here we come</h3>
    </hgroup>
    <footer class="source white" style="text-shadow: 0 0 2px #000">source: http://www.flickr.com/photos/binaryape/4882162452/</footer>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>Socorro is an important part of Firefox, although not really a part of Firefox.</li>
          <li>It takes crash reports and turn the dumped binary into property dumps with symbols. This makes these reports actually useful.</li>
          <li>The data that we get through Socorro allow us to build a better product by eliminating bugs.</li>
          <li>Each crash report gets a signature, which is a string identities the crash with a line of stack trace, or something like that. Kind of like a hash.</li>
          <li>Many crashes can have the same signature.</li>
          <li>My task is to find "explosive" crash signatures, which are crashes signatures that jumps in volume overnight.</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Firefox crash stats</h2>
    </hgroup>
    <article>
      <ul>
        <li>Named Socorro</li>
        <li>Collects crash reports and display them in a convenient <a href="http://crash-stats.mozilla.org">web app</a></li>
        <li>Helps Firefox developers discover and eventually fix bugs</li>
      </ul>
      <p>My task</p>
      <ul>
        <li>Identify "explosive" crashes automatically</li>
      </ul>
    </article>
  </slide>


  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>When we think of explosive crashes, we think a big spike/step if we plot the number of crashes over time. </li>
          <li>Math definition of that is a little harder, but we can either think of it as an unexpected deviation from an expected value or if the rate of change is larger than some defined value.</li>
          <li>Its many applications results in many different papers about the subject. A lot of what I saw in papers are trying to detect "not so obvious spikes" and detecting it with humans in a way so that people can be confident that there is indeed an unexpected event.</li>
          <li>A lot are not directly applicable. However most that I saw used a time series approach.</li>
          <li>So I tried follow suit.</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>What is an "explosive" crash?</h2>
    </hgroup>
    <article>
      <ul>
        <li>
          A lot of different definitions
          <ul>
            <li>Positive deviation from expected value</li>
            <li>Large derivative values</li>
          </ul>
        </li>
        <li>
          Many different applications
          <ul>
            <li>Disease outbreak detection, network traffic anomaly, trending topics, stock markets, industrial process control</li>
          </ul>
        </li>
      </ul>
      <div class="flexbox vcenter">
        <img src="images/doodle.png" />
        <img src="images/doodle-graph.png" />
      </div>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <li>First defined as a big positive deviation.</li>
        <li>Used standard time series analysis methods to predict the future.</li>
        <li>Used models directly from economics textbooks, which worked horribly as the firefox crash counts are going upwards all the time in a seasonal fashion.</li>
        <li>Sinusoidal models worked quite well for time series that exhibits sinusoidal pattern.</li>
        <li>The global crash counts on the left. We see a sinuosidal pattern where we experience a dip in the crash counts over weekends.</li>
        <li>Using sinusoidal model to predict in the middle and we see it does fairly well.</li>
        <li>Turns out, not all signatures exhibits periodic behaviours.</li>
      </section>
    </aside>
    <hgroup>
      <h2>How can we find these signatures?</h2>
    </hgroup>
    <article>
      <ul>
        <li>Defined as a big, positive deviation from some expected value.</li>
        <li>Tried many different approaches
          <ul>
            <li>Prediction based approach</li>
            <li>Time series analysis</li>
            <li>Fancy math everywhere</li>
          </ul>
        </li>
      </ul>
      <div class="flexbox vcenter">
        <img src="images/globalsigs.png" >
        <img src="images/predictedglobal.png" >
        <img src="images/badsine.png" >
      </div>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>Looking at a couple of time series and say that every other time series exhibits the same pattern is over generalizing.</li>
          <li>Frankly, a lot of the time series did not exhibits the patterns I had expected at all.</li>
          <li>I didn't really have any training examples other than one time when a google doodle crashed Firefox.</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Problems with time series approach</h2>
    </hgroup>
    <article>
      <ul>
        <li>Not all signature time series exhibits the same behaviour</li>
        <li>Cannot easily generalize a model developed by looking at a very small subset of the data</li>
        <li>Only one known training example</li>
      </ul>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>At one point it was decided that I should try the derivative approach as it is conceptually simpler.</li>
          <li>A large derivative means a large increase, therefore explosive.</li>
          <li>At this point I was also running out of time as it is my second project.</li>
          <li>Trying a simple approach doesn't hurt.</li>
          <li>Used a very low threshold value to find all potential.</li>
          <li>Manually labeled examples. Found things..</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>A different approach</h2>
    </hgroup>
    <article>
      <ul>
        <li>Attempted detection with the derivative formula</li>
        <li>
          Used overly optimistic approach to find potential examples
          <ul>
            <li>Manually labeled everything</li>
            <li>Was able to find many examples</li>
          </ul>
        </li>
        <li>Turns out simple is good enough</li>
        <li>Found most manually labeled examples</li>
      </ul>
      <div class="flexbox vcenter">
        <img src="images/expl1.png" />
        <img src="images/expl2.png" />
        <img src="images/expl3.png" />
      </div>
    </article>
  </slide>

  <slide class="fill nobackground" style="background-image: url(images/socorro.jpg)">
    <hgroup>
      <h2>Socorro is complicated</h2>
      <h3>A lot of components to get familiar with</h3>
    </hgroup>
  </slide>

  <slide>
    <aside class="note">
      <section>
        <ul>
          <li>Needed to implement something as I was running low on time</li>
          <li>Picking threshold based on t-statistics.</li>
          <li>Statistics is fun. Need to write some code</li>
          <li>Socorro's infrastructure is complicated. Coding will take a long time</li>
          <li>The only logical place is to implement as a cron job.</li>
          <li>Runs every 24 hours to classify previous UTC day's crashes</li>
        </ul>
      </section>
    </aside>
    <hgroup>
      <h2>Implementing in Socorro</h2>
    </hgroup>
    <article>
      <ul>
        <li>
          Starting to run low on time
        </li>
        <li>
          Implemented a method to pick threshold automatically based on historic
          observations
        </li>
        <li>
          Implemented as a cron job that runs every day
        </li>
      </ul>
      <div class="vcenter flexbox">
        <img src="images/expl-impl.png" />
      </div>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
      </section>
    </aside>
    <hgroup>
      <h2>Current Status</h2>
    </hgroup>
    <article>
      <ul>
        <li>Landed in master</li>
        <li>Report is hidden for now for a week or two before it is enabled.</li>
        <li>Code:
          <ul>
            <li><a href="https://github.com/mozilla/socorro">https://github.com/mozilla/socorro</a></li>
            <li><a href="https://github.com/shuhaowu/detonator">https://github.com/shuhaowu/detonator</a></li>
          </ul>
        </li>
      </ul>
      <p>Next step: improve the UI a little, investigate better models (ARMA?)</p>
    </article>
  </slide>

  <slide>
    <aside class="note">
      <section>
      </section>
    </aside>
    <hgroup>
      <h2>Conclusion</h2>
    </hgroup>
    <article>
      <ul>
        <li>Awesome experience</li>
        <li>Working on open source is a big plus</li>
        <li>Special thanks to my mentors: Mike Cooper and Chris Lonnen</li>
      </ul>
    </article>
  </slide>

  <slide class="thank-you-slide segue nobackground">
    <article class="flexbox vleft auto-fadein">
      <h2>Questions?</h2>
      <p>Slides available at <a href="https://shuhaowu.com/static/pres/moz-intern/" style="color: white;">https://shuhaowu.com/static/pres/moz-intern/</a></p>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
